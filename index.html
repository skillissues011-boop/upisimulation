<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UPI Payment Simulator Web</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }

        .check-anim {
            stroke-dasharray: 166;
            stroke-dashoffset: 166;
            stroke-width: 2;
            stroke-miterlimit: 10;
            stroke: #fff;
            fill: none;
            animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
        }

        .check-bg {
            animation: fill .4s ease-in-out .4s forwards, scale .3s ease-in-out .9s both;
        }

        @keyframes stroke {
            100% { stroke-dashoffset: 0; }
        }
        @keyframes fill {
            100% { box-shadow: inset 0px 0px 0px 30px #22c55e; }
        }
        @keyframes scale {
            0%, 100% { transform: none; }
            50% { transform: scale3d(1.1, 1.1, 1); }
        }

        .fade-in {
            animation: fadeIn 0.4s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .modal-overlay {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .slide-up {
            animation: slideUp 0.3s ease-out;
        }

        .pulse-ring {
            animation: pulse-ring 1.5s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }

        @keyframes pulse-ring {
            0% { transform: scale(0.95); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.7; }
            100% { transform: scale(0.95); opacity: 1; }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen flex flex-col">

    <!-- App Container -->
    <div id="app-container" class="flex-1 flex flex-col">
        <!-- Content injected here -->
    </div>

    <!-- Modal Container -->
    <div id="modal-container"></div>

    <script>
        // --- State Management ---
        const state = {
            screen: 'home', 
            balance: 12500.50,
            transaction: {
                payeeName: '',
                payeeId: '',
                amount: '0',
                note: ''
            },
            pin: '',
            history: [
                { id: 1, name: 'Zomato Foods', amount: 450, date: 'Today, 10:30 AM', type: 'debit', status: 'success', upiId: 'zomato@paytm' },
                { id: 2, name: 'Rahul Sharma', amount: 2000, date: 'Yesterday', type: 'credit', status: 'success', upiId: 'rahul@oksbi' },
                { id: 3, name: 'State Electricity Board', amount: 890, date: '20 Oct', type: 'debit', status: 'success', upiId: 'electricity@bill' },
                { id: 4, name: 'Amazon Payment', amount: 1599, date: '18 Oct', type: 'debit', status: 'success', upiId: 'amazon@icici' },
                { id: 5, name: 'Salary Credit', amount: 45000, date: '1 Oct', type: 'credit', status: 'success', upiId: 'company@hdfc' }
            ],
            recentPeople: [
                { name: 'Alex Kumar', upiId: 'alex@paytm', avatar: 'AK' },
                { name: 'Sarah Patel', upiId: 'sarah@oksbi', avatar: 'SP' },
                { name: 'Mom', upiId: 'mom@phonepe', avatar: 'M' },
                { name: 'Dad', upiId: 'dad@googlepay', avatar: 'D' },
                { name: 'Shop', upiId: 'shop@upi', avatar: 'S' },
                { name: 'Rahul Verma', upiId: 'rahul@paytm', avatar: 'RV' },
                { name: 'Priya Singh', upiId: 'priya@ybl', avatar: 'PS' }
            ],
            bills: [
                { type: 'mobile', name: 'Mobile Recharge', icon: 'fa-mobile-screen', color: 'text-blue-500', bg: 'bg-blue-50' },
                { type: 'electricity', name: 'Electricity', icon: 'fa-lightbulb', color: 'text-yellow-500', bg: 'bg-yellow-50' },
                { type: 'dth', name: 'DTH', icon: 'fa-satellite-dish', color: 'text-purple-500', bg: 'bg-purple-50' },
                { type: 'googleplay', name: 'Google Play', icon: 'fa-play', color: 'text-red-500', bg: 'bg-red-50' },
                { type: 'broadband', name: 'Broadband', icon: 'fa-wifi', color: 'text-cyan-500', bg: 'bg-cyan-50' },
                { type: 'water', name: 'Water', icon: 'fa-droplet', color: 'text-blue-400', bg: 'bg-blue-50' }
            ]
        };

        const container = document.getElementById('app-container');
        const modalContainer = document.getElementById('modal-container');

        // --- Utility Functions ---
        function generateTransactionId() {
            return Math.floor(100000000000 + Math.random() * 900000000000).toString();
        }

        function getCurrentDateTime() {
            const now = new Date();
            return now.toLocaleString('en-IN', { 
                day: 'numeric', 
                month: 'short', 
                year: 'numeric',
                hour: '2-digit', 
                minute: '2-digit'
            });
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 z-50 px-6 py-4 rounded-xl shadow-2xl text-white font-medium slide-up ${type === 'success' ? 'bg-green-500' : 'bg-red-500'}`;
            toast.innerHTML = `
                <div class="flex items-center gap-3">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.style.animation = 'fadeOut 0.3s ease-out';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // --- Modal Functions ---
        function showModal(content) {
            modalContainer.innerHTML = `
                <div class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-overlay" onclick="closeModal()">
                    <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full slide-up" onclick="event.stopPropagation()">
                        ${content}
                    </div>
                </div>
            `;
        }

        function closeModal() {
            modalContainer.innerHTML = '';
        }

        function showBillPayment(billType) {
            const bill = state.bills.find(b => b.type === billType);
            showModal(`
                <div class="p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-bold text-gray-900">Pay ${bill.name}</h2>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                ${billType === 'mobile' ? 'Mobile Number' : billType === 'electricity' ? 'Consumer ID' : 'Account Number'}
                            </label>
                            <input type="text" id="billId" 
                                class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-orange-500"
                                placeholder="${billType === 'mobile' ? '98XXXXXXXX' : 'Enter ID'}">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Amount</label>
                            <div class="relative">
                                <span class="absolute left-4 top-3 text-gray-500">₹</span>
                                <input type="number" id="billAmount" 
                                    class="w-full pl-8 pr-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-orange-500"
                                    placeholder="0.00">
                            </div>
                        </div>
                        
                        <button onclick="processBillPayment('${billType}')" 
                            class="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-3 rounded-xl transition">
                            Pay Bill
                        </button>
                    </div>
                </div>
            `);
        }

        function processBillPayment(billType) {
            const billId = document.getElementById('billId').value;
            const amount = document.getElementById('billAmount').value;
            
            if (!billId || !amount || parseFloat(amount) <= 0) {
                showToast('Please enter valid details', 'error');
                return;
            }

            const bill = state.bills.find(b => b.type === billType);
            closeModal();
            
            state.transaction.payeeName = bill.name;
            state.transaction.payeeId = billId;
            state.transaction.amount = amount;
            navigate('pin');
        }

        function showTransactionDetails(txId) {
            const tx = state.history.find(t => t.id === txId);
            if (!tx) return;

            showModal(`
                <div class="p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-bold text-gray-900">Transaction Details</h2>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 rounded-full ${tx.type === 'credit' ? 'bg-green-100 text-green-600' : 'bg-orange-100 text-orange-600'} flex items-center justify-center text-2xl mx-auto mb-3">
                            <i class="fas fa-${tx.type === 'credit' ? 'arrow-down' : 'arrow-up'}"></i>
                        </div>
                        <p class="text-3xl font-bold ${tx.type === 'credit' ? 'text-green-600' : 'text-gray-900'}">
                            ${tx.type === 'credit' ? '+' : '-'} ₹${tx.amount.toLocaleString('en-IN')}
                        </p>
                        <p class="text-sm text-gray-500 mt-1">${tx.type === 'credit' ? 'Received from' : 'Paid to'}</p>
                        <p class="font-bold text-gray-900">${tx.name}</p>
                    </div>
                    
                    <div class="space-y-3 bg-gray-50 rounded-xl p-4">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Status</span>
                            <span class="font-semibold text-green-600 capitalize">${tx.status}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Date & Time</span>
                            <span class="font-semibold text-gray-900">${tx.date}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">UPI ID</span>
                            <span class="font-semibold text-gray-900">${tx.upiId}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Transaction ID</span>
                            <span class="font-mono text-sm text-gray-700">${generateTransactionId().slice(0, 12)}</span>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3 mt-6">
                        <button onclick="shareTransaction(${txId})" 
                            class="bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold py-3 rounded-xl transition">
                            <i class="fas fa-share-nodes mr-2"></i>Share
                        </button>
                        <button onclick="closeModal()" 
                            class="bg-orange-600 hover:bg-orange-700 text-white font-semibold py-3 rounded-xl transition">
                            Close
                        </button>
                    </div>
                </div>
            `);
        }

        function shareTransaction(txId) {
            showToast('Transaction details copied!');
            closeModal();
        }

        function showQRScanner() {
            showModal(`
                <div class="p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-bold text-gray-900">Scan QR Code</h2>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="relative bg-gray-900 rounded-xl overflow-hidden mb-6">
                        <div class="aspect-square flex items-center justify-center">
                            <div class="w-64 h-64 border-4 border-orange-500 rounded-xl relative">
                                <div class="absolute top-0 left-0 w-8 h-8 border-t-4 border-l-4 border-white"></div>
                                <div class="absolute top-0 right-0 w-8 h-8 border-t-4 border-r-4 border-white"></div>
                                <div class="absolute bottom-0 left-0 w-8 h-8 border-b-4 border-l-4 border-white"></div>
                                <div class="absolute bottom-0 right-0 w-8 h-8 border-b-4 border-r-4 border-white"></div>
                                
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <div class="w-4 h-full bg-orange-500 opacity-50 pulse-ring"></div>
                                </div>
                            </div>
                        </div>
                        <div class="absolute bottom-4 left-0 right-0 text-center">
                            <p class="text-white text-sm">Position QR code within frame</p>
                        </div>
                    </div>
                    
                    <button onclick="simulateQRScan()" 
                        class="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-3 rounded-xl transition">
                        Simulate QR Scan
                    </button>
                </div>
            `);
        }

        function simulateQRScan() {
            closeModal();
            showToast('QR Code Scanned!');
            setTimeout(() => {
                initiatePay('Merchant Store', 'merchant@paytm');
            }, 500);
        }

        // --- Shared Components ---

        function renderNavbar(activeTab = '') {
            return `
                <nav class="bg-white border-b border-gray-200 sticky top-0 z-40">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div class="flex justify-between h-16">
                            <div class="flex items-center gap-3 cursor-pointer" onclick="navigate('home')">
                                <div class="w-10 h-10 bg-orange-600 rounded-lg flex items-center justify-center text-white shadow-lg shadow-orange-200">
                                    <i class="fas fa-wallet text-lg"></i>
                                </div>
                                <span class="font-bold text-xl tracking-tight text-gray-900">Pay<span class="text-orange-600">Sim</span></span>
                            </div>
                            
                            <div class="hidden md:flex items-center space-x-8">
                                <button onclick="navigate('home')" class="${activeTab === 'home' ? 'text-orange-600 border-orange-600' : 'text-gray-500 border-transparent hover:text-gray-700'} border-b-2 px-1 pt-1 text-sm font-medium h-full transition-colors">Dashboard</button>
                                <button onclick="navigate('history')" class="${activeTab === 'history' ? 'text-orange-600 border-orange-600' : 'text-gray-500 border-transparent hover:text-gray-700'} border-b-2 px-1 pt-1 text-sm font-medium h-full transition-colors">Transactions</button>
                                <button onclick="navigate('balance')" class="${activeTab === 'balance' ? 'text-orange-600 border-orange-600' : 'text-gray-500 border-transparent hover:text-gray-700'} border-b-2 px-1 pt-1 text-sm font-medium h-full transition-colors">Check Balance</button>
                            </div>

                            <div class="flex items-center gap-4">
                                <div class="text-right hidden sm:block leading-tight">
                                    <p class="text-xs text-gray-500">Welcome back,</p>
                                    <p class="font-bold text-sm">John Doe</p>
                                </div>
                                <div class="w-10 h-10 bg-gradient-to-r from-orange-100 to-orange-200 rounded-full flex items-center justify-center text-orange-700 font-bold border-2 border-white shadow-sm">
                                    JD
                                </div>
                            </div>
                        </div>
                    </div>
                </nav>
            `;
        }

        function renderFooter() {
            return `
                <footer class="bg-white border-t border-gray-200 mt-auto">
                    <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
                        <p class="text-center text-gray-400 text-sm">
                            &copy; 2024 PaySim Web. This is a simulation. No real money is involved.
                        </p>
                    </div>
                </footer>
            `;
        }

        // --- Screens ---

        function renderHome() {
            container.innerHTML = `
                ${renderNavbar('home')}
                
                <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 fade-in w-full">
                    <!-- Hero Section -->
                    <div class="bg-gradient-to-r from-orange-500 to-red-600 rounded-3xl p-8 text-white shadow-xl shadow-orange-200 mb-10 relative overflow-hidden">
                        <div class="absolute top-0 right-0 p-8 opacity-10 transform translate-x-10 -translate-y-10">
                            <i class="fas fa-shield-alt text-[12rem]"></i>
                        </div>
                        <div class="relative z-10 max-w-2xl">
                            <h1 class="text-3xl font-bold mb-2">Secure & Fast UPI Payments</h1>
                            <p class="text-orange-100 text-lg mb-8">Pay friends, merchants, and bills instantly directly from your bank account.</p>
                            
                            <div class="flex flex-wrap gap-4">
                                <button onclick="showQRScanner()" class="bg-white text-orange-600 px-6 py-3 rounded-xl font-bold shadow-lg hover:shadow-xl hover:scale-105 transition flex items-center gap-2">
                                    <i class="fas fa-qrcode"></i> Scan QR
                                </button>
                                <button onclick="startPayment('Contacts')" class="bg-orange-700/50 backdrop-blur-sm text-white border border-white/20 px-6 py-3 rounded-xl font-semibold hover:bg-orange-700/70 transition flex items-center gap-2">
                                    <i class="fas fa-paper-plane"></i> Send Money
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <!-- Left Column: Quick Actions & People -->
                        <div class="lg:col-span-2 space-y-8">
                            
                            <!-- Transfer Money Section -->
                            <section class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                                <h2 class="text-lg font-bold text-gray-800 mb-6 flex items-center gap-2">
                                    <i class="fas fa-money-bill-transfer text-orange-500"></i> Transfer Money
                                </h2>
                                <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                                    <button onclick="startPayment('Contacts')" class="p-4 rounded-xl bg-orange-50 hover:bg-orange-100 transition flex flex-col items-center gap-3 group">
                                        <div class="w-12 h-12 bg-white rounded-full flex items-center justify-center text-orange-600 shadow-sm group-hover:scale-110 transition">
                                            <i class="fas fa-user"></i>
                                        </div>
                                        <span class="font-medium text-sm text-gray-700">To Contact</span>
                                    </button>
                                    <button onclick="startPayment('Bank Transfer')" class="p-4 rounded-xl bg-orange-50 hover:bg-orange-100 transition flex flex-col items-center gap-3 group">
                                        <div class="w-12 h-12 bg-white rounded-full flex items-center justify-center text-orange-600 shadow-sm group-hover:scale-110 transition">
                                            <i class="fas fa-building-columns"></i>
                                        </div>
                                        <span class="font-medium text-sm text-gray-700">To Bank</span>
                                    </button>
                                    <button onclick="startPayment('Self Transfer')" class="p-4 rounded-xl bg-orange-50 hover:bg-orange-100 transition flex flex-col items-center gap-3 group">
                                        <div class="w-12 h-12 bg-white rounded-full flex items-center justify-center text-orange-600 shadow-sm group-hover:scale-110 transition">
                                            <i class="fas fa-arrow-right-arrow-left"></i>
                                        </div>
                                        <span class="font-medium text-sm text-gray-700">To Self</span>
                                    </button>
                                    <button onclick="navigate('balance')" class="p-4 rounded-xl bg-orange-50 hover:bg-orange-100 transition flex flex-col items-center gap-3 group">
                                        <div class="w-12 h-12 bg-white rounded-full flex items-center justify-center text-orange-600 shadow-sm group-hover:scale-110 transition">
                                            <i class="fas fa-wallet"></i>
                                        </div>
                                        <span class="font-medium text-sm text-gray-700">Check Balance</span>
                                    </button>
                                </div>
                            </section>

                            <!-- Recent People -->
                            <section class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                                <h2 class="text-lg font-bold text-gray-800 mb-6">Recent People</h2>
                                <div class="flex gap-6 overflow-x-auto pb-2 custom-scrollbar">
                                    ${state.recentPeople.map((person, i) => `
                                        <button onclick="initiatePay('${person.name}', '${person.upiId}')" class="flex flex-col items-center gap-3 min-w-[80px] group">
                                            <div class="w-16 h-16 rounded-full bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center text-gray-600 font-bold border-4 border-transparent group-hover:border-orange-100 transition text-lg relative">
                                                ${person.avatar}
                                                <div class="absolute bottom-0 right-0 w-5 h-5 bg-green-500 border-2 border-white rounded-full"></div>
                                            </div>
                                            <span class="text-sm font-medium text-gray-600 group-hover:text-orange-600 transition">${person.name.split(' ')[0]}</span>
                                        </button>
                                    `).join('')}
                                </div>
                            </section>
                        </div>

                        <!-- Right Column: Bills & Promos -->
                        <div class="space-y-8">
                            <section class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 h-full">
                                <h2 class="text-lg font-bold text-gray-800 mb-6">Recharge & Pay Bills</h2>
                                <div class="grid grid-cols-2 gap-4">
                                    ${state.bills.map(bill => `
                                        <button onclick="showBillPayment('${bill.type}')" class="flex items-center gap-3 p-3 rounded-xl hover:bg-gray-50 transition text-left group">
                                            <div class="w-10 h-10 ${bill.bg} rounded-lg flex items-center justify-center ${bill.color} group-hover:scale-110 transition">
                                                <i class="fas ${bill.icon}"></i>
                                            </div>
                                            <span class="text-sm font-medium text-gray-600 group-hover:text-gray-900">${bill.name}</span>
                                        </button>
                                    `).join('')}
                                </div>
                                
                                <div class="mt-8 bg-gradient-to-br from-indigo-600 to-purple-700 rounded-xl p-5 text-white flex justify-between items-center shadow-md cursor-pointer hover:shadow-lg transition" onclick="showToast('Refer feature coming soon!')">
                                    <div>
                                        <p class="font-bold">Refer & Earn</p>
                                        <p class="text-xs text-indigo-200 mt-1">Get ₹100 for every friend</p>
                                    </div>
                                    <div class="bg-white/20 p-2 rounded-lg">
                                        <i class="fas fa-gift text-xl"></i>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>
                </main>
                ${renderFooter()}
            `;
        }

        function renderHistory() {
            const historyHtml = state.history.map(tx => `
                <div class="bg-white p-5 rounded-xl border border-gray-100 hover:shadow-md transition flex items-center justify-between group cursor-pointer" onclick="showTransactionDetails(${tx.id})">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 rounded-full ${tx.type === 'debit' ? 'bg-gray-100 text-gray-600' : 'bg-green-100 text-green-600'} flex items-center justify-center text-lg">
                            <i class="fas ${tx.type === 'debit' ? 'fa-arrow-up rotate-45' : 'fa-arrow-down'}"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-800">${tx.name}</h3>
                            <p class="text-sm text-gray-500">${tx.date} • <span class="capitalize">${tx.status}</span></p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="font-bold text-lg ${tx.type === 'credit' ? 'text-green-600' : 'text-gray-800'}">
                            ${tx.type === 'credit' ? '+' : '-'} ₹${tx.amount.toLocaleString('en-IN')}
                        </p>
                        <p class="text-orange-600 text-xs font-semibold opacity-0 group-hover:opacity-100 transition mt-1">View Details</p>
                    </div>
                </div>
            `).join('');

            container.innerHTML = `
                ${renderNavbar('history')}
                <main class="max-w-4xl mx-auto px-4 py-8 fade-in w-full flex-1">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
                        <h1 class="text-2xl font-bold text-gray-800">Transaction History</h1>
                        <div class="flex gap-2 w-full sm:w-auto">
                             <input type="text" placeholder="Search transactions" class="flex-1 sm:flex-none border border-gray-300 rounded-lg px-4 py-2 text-sm focus:outline-none focus:border-orange-500">
                             <button class="bg-gray-100 hover:bg-gray-200 px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap"><i class="fas fa-filter mr-2"></i>Filter</button>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        ${state.history.length > 0 ? historyHtml : `
                            <div class="text-center py-20 bg-white rounded-2xl border border-dashed border-gray-300">
                                <div class="w-16 h-16 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-4 text-gray-400">
                                    <i class="fas fa-receipt text-2xl"></i>
                                </div>
                                <p class="text-gray-500 font-medium">No transactions found</p>
                            </div>
                        `}
                    </div>
                </main>
                ${renderFooter()}
            `;
        }

        function renderAmountScreen() {
            container.innerHTML = `
                ${renderNavbar()}
                <main class="flex-1 flex items-center justify-center p-4 fade-in bg-gray-50">
                    <div class="bg-white w-full max-w-md rounded-2xl shadow-xl overflow-hidden border border-gray-100">
                        <div class="bg-gray-50 px-6 py-4 border-b border-gray-100 flex items-center justify-between">
                            <button onclick="navigate('home')" class="text-gray-500 hover:text-gray-800 transition">
                                <i class="fas fa-arrow-left"></i> Back
                            </button>
                            <span class="text-sm font-bold text-gray-400 uppercase tracking-wider">Send Money</span>
                            <div class="w-6"></div> 
                        </div>

                        <div class="p-8 flex flex-col items-center">
                            <div class="w-16 h-16 rounded-full bg-orange-100 text-orange-600 flex items-center justify-center text-2xl font-bold mb-4">
                                ${state.transaction.payeeName[0]}
                            </div>
                            <h2 class="text-xl font-bold text-gray-900 text-center">Paying ${state.transaction.payeeName}</h2>
                            <p class="text-gray-500 text-sm mb-8">${state.transaction.payeeId}</p>

                            <div class="relative w-full mb-8">
                                <div class="flex items-center justify-center text-5xl font-bold text-gray-800">
                                    <span class="mr-2 text-gray-400">₹</span>
                                    <input type="text" id="amountDisplay" value="${state.transaction.amount === '0' ? '' : state.transaction.amount}" 
                                        class="w-48 text-center bg-transparent border-none outline-none placeholder-gray-200" 
                                        placeholder="0" readonly>
                                </div>
                                <div class="flex justify-center mt-6">
                                    <input type="text" id="noteInput" placeholder="Add a note (Optional)" 
                                        value="${state.transaction.note}"
                                        onchange="state.transaction.note = this.value"
                                        class="text-center bg-gray-50 border-gray-200 rounded-full py-2 px-6 text-sm outline-none focus:bg-white focus:ring-2 focus:ring-orange-100 transition w-64">
                                </div>
                            </div>

                             <!-- Desktop Keypad -->
                            <div class="w-full max-w-xs grid grid-cols-3 gap-3 mb-6">
                                ${[1,2,3,4,5,6,7,8,9].map(num => `
                                    <button onclick="updateAmount('${num}')" class="h-12 rounded-lg bg-gray-50 hover:bg-gray-100 font-semibold text-lg text-gray-700 transition border border-gray-200 active:scale-95">${num}</button>
                                `).join('')}
                                <button onclick="updateAmount('.')" class="h-12 rounded-lg bg-gray-50 hover:bg-gray-100 font-bold text-lg text-gray-700 transition border border-gray-200 active:scale-95">.</button>
                                <button onclick="updateAmount('0')" class="h-12 rounded-lg bg-gray-50 hover:bg-gray-100 font-semibold text-lg text-gray-700 transition border border-gray-200 active:scale-95">0</button>
                                <button onclick="updateAmount('back')" class="h-12 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 transition flex items-center justify-center border border-gray-200 active:scale-95">
                                    <i class="fas fa-backspace"></i>
                                </button>
                            </div>

                            <button onclick="goToPin()" id="payBtn" disabled class="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-orange-200 disabled:opacity-50 disabled:shadow-none disabled:cursor-not-allowed transition transform active:scale-95 flex justify-between items-center px-6">
                                <span>Proceed to Pay</span>
                                <span id="payBtnAmt">₹0</span>
                            </button>
                            
                            <div class="mt-4 flex items-center justify-center gap-2 text-xs text-gray-400">
                                <i class="fas fa-shield-alt text-green-500"></i>
                                <span>100% Secure Payment by PaySim</span>
                            </div>
                        </div>
                    </div>
                </main>
            `;
        }

        function renderPinScreen() {
            container.innerHTML = `
                ${renderNavbar()}
                <main class="flex-1 flex items-center justify-center p-4 fade-in bg-gray-800">
                    <div class="bg-white w-full max-w-sm rounded-3xl shadow-2xl overflow-hidden relative">
                        <!-- Top Bar -->
                        <div class="bg-gray-50 px-6 py-4 flex justify-between items-center border-b border-gray-200">
                            <div class="flex flex-col">
                                <span class="text-xs font-bold text-gray-500 tracking-wider">UPI PIN</span>
                                <div class="flex items-center gap-1">
                                    <span class="text-[10px] bg-gray-200 px-1 rounded text-gray-600 font-bold">LITE</span>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="text-xs text-gray-500">Amount</p>
                                <p class="font-bold text-lg text-gray-800">₹${parseFloat(state.transaction.amount).toLocaleString('en-IN')}</p>
                            </div>
                        </div>

                        <div class="p-8 pb-4 bg-white">
                            <div class="mb-8">
                                <p class="text-sm font-medium text-gray-500 mb-1">Paying to</p>
                                <p class="text-lg font-bold text-gray-900">${state.transaction.payeeName}</p>
                                <p class="text-xs text-gray-400 truncate">${state.transaction.payeeId}</p>
                            </div>

                            <div class="flex flex-col items-center mb-8">
                                <p class="text-xs font-bold text-gray-400 mb-6 tracking-widest">ENTER 4-DIGIT UPI PIN</p>
                                <div class="flex gap-4">
                                    ${[1,2,3,4].map(i => `
                                        <div id="dot-${i}" class="w-4 h-4 rounded-full border-2 border-gray-300 bg-white transition-all duration-200"></div>
                                    `).join('')}
                                </div>
                                <p class="text-xs text-gray-400 mt-4">(Try: 7777)</p>
                            </div>

                            <!-- Secure Keypad -->
                            <div class="grid grid-cols-3 gap-0 border-t border-gray-100">
                                 ${[1,2,3,4,5,6,7,8,9].map(num => `
                                    <button onclick="enterPin('${num}')" class="h-16 text-2xl font-medium text-gray-700 hover:bg-gray-50 active:bg-gray-100 transition border-r border-b border-gray-50 last:border-r-0">${num}</button>
                                `).join('')}
                                <button onclick="enterPin('back')" class="h-16 flex items-center justify-center hover:bg-gray-50 active:bg-gray-100 transition border-b border-gray-50">
                                    <i class="fas fa-backspace text-xl text-gray-500"></i>
                                </button>
                                <button onclick="enterPin('0')" class="h-16 text-2xl font-medium text-gray-700 hover:bg-gray-50 active:bg-gray-100 transition border-r border-b border-gray-50">0</button>
                                <button onclick="submitPin()" class="h-16 bg-orange-600 text-white flex items-center justify-center hover:bg-orange-700 active:bg-orange-800 transition">
                                    <i class="fas fa-check text-xl"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </main>
            `;
        }

        function renderProcessing() {
            container.innerHTML = `
                ${renderNavbar()}
                <main class="flex-1 flex flex-col items-center justify-center bg-white fade-in relative overflow-hidden">
                    <div class="relative z-10 text-center max-w-md w-full p-8 rounded-2xl border border-gray-100 shadow-xl bg-white/80 backdrop-blur-sm mx-4">
                        <div class="w-24 h-24 bg-orange-50 rounded-full flex items-center justify-center mx-auto mb-8 relative">
                             <div class="absolute w-full h-full rounded-full border-4 border-orange-100 border-t-orange-600 animate-spin"></div>
                             <i class="fas fa-lock text-orange-600 text-3xl"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">Processing Payment...</h2>
                        <p class="text-gray-500">Please do not refresh the page</p>
                        
                        <div class="mt-8 pt-8 border-t border-gray-100">
                             <p class="text-sm text-gray-400 uppercase tracking-wide">Amount</p>
                             <p class="text-4xl font-bold text-gray-800 mt-2">₹${parseFloat(state.transaction.amount).toLocaleString('en-IN')}</p>
                        </div>
                    </div>
                </main>
            `;
            
            setTimeout(() => {
                console.log('Entered PIN:', state.pin);
                const isSuccess = state.pin === '7777';
                console.log('PIN Check:', isSuccess);
                if(isSuccess) {
                    processTransaction();
                    navigate('success');
                } else {
                    showToast('Wrong PIN! Try 7777', 'error');
                    state.pin = '';
                    navigate('pin');
                }
            }, 2500);
        }

        function renderSuccess() {
            const txId = generateTransactionId();
            container.innerHTML = `
                ${renderNavbar()}
                <main class="flex-1 flex flex-col items-center justify-center bg-green-500 text-white fade-in relative py-12">
                    <div class="max-w-md w-full bg-white rounded-3xl shadow-2xl overflow-hidden text-gray-800 relative z-10 mx-4">
                        <!-- Green Top -->
                        <div class="bg-green-500 p-8 flex flex-col items-center text-white pb-12">
                            <div class="w-20 h-20 bg-white rounded-full flex items-center justify-center mb-4 shadow-lg">
                                <svg class="w-12 h-12" viewBox="0 0 52 52">
                                    <circle class="check-bg opacity-0" cx="26" cy="26" r="25" fill="none"/>
                                    <path class="check-anim stroke-green-500" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
                                </svg>
                            </div>
                            <h1 class="text-2xl font-bold">Payment Successful</h1>
                            <p class="text-green-100 mt-1">${getCurrentDateTime()}</p>
                        </div>

                        <!-- Ticket Cutout Effect -->
                        <div class="relative h-6 bg-white -mt-6">
                            <div class="absolute -top-3 left-0 w-6 h-6 bg-green-500 rounded-full -ml-3"></div>
                            <div class="absolute -top-3 right-0 w-6 h-6 bg-green-500 rounded-full -mr-3"></div>
                            <div class="border-t-2 border-dashed border-gray-200 mt-3 mx-6"></div>
                        </div>

                        <!-- Details -->
                        <div class="p-8 pt-2">
                            <div class="text-center mb-8">
                                <p class="text-5xl font-bold text-gray-900">₹${parseFloat(state.transaction.amount).toLocaleString('en-IN')}</p>
                                <p class="text-sm text-gray-400 mt-2 uppercase tracking-wide">Transaction ID: ${txId}</p>
                            </div>

                            <div class="flex items-center gap-4 bg-gray-50 p-4 rounded-xl border border-gray-100 mb-6">
                                <div class="w-10 h-10 rounded-full bg-orange-100 text-orange-600 flex items-center justify-center font-bold">
                                    ${state.transaction.payeeName[0]}
                                </div>
                                <div>
                                    <p class="text-xs text-gray-500">Paid to</p>
                                    <p class="font-bold text-gray-800">${state.transaction.payeeName}</p>
                                    <p class="text-xs text-gray-500">${state.transaction.payeeId}</p>
                                </div>
                            </div>

                            ${state.transaction.note ? `
                            <div class="bg-yellow-50 border border-yellow-100 rounded-xl p-4 mb-6">
                                <p class="text-xs text-yellow-700 font-semibold mb-1">Note</p>
                                <p class="text-sm text-gray-700">${state.transaction.note}</p>
                            </div>
                            ` : ''}

                            <div class="grid grid-cols-2 gap-3">
                                <button onclick="navigate('home')" class="w-full bg-gray-900 hover:bg-black text-white font-bold py-3 rounded-xl transition active:scale-95">Done</button>
                                <button onclick="showToast('Receipt shared!')" class="w-full bg-white border border-gray-200 text-gray-700 hover:bg-gray-50 font-bold py-3 rounded-xl transition flex items-center justify-center gap-2 active:scale-95">
                                    <i class="fas fa-share-nodes"></i> Share
                                </button>
                            </div>
                        </div>
                    </div>
                </main>
            `;
        }
        
        function renderBalance() {
            const totalDebit = state.history.filter(tx => tx.type === 'debit').reduce((sum, tx) => sum + tx.amount, 0);
            
            container.innerHTML = `
                ${renderNavbar('balance')}
                <main class="flex-1 max-w-7xl mx-auto px-4 py-12 w-full fade-in">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
                        
                        <!-- Balance Card -->
                        <div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-3xl p-8 text-white shadow-2xl relative overflow-hidden h-64 flex flex-col justify-between">
                            <div class="absolute top-0 right-0 p-8 opacity-5">
                                <i class="fas fa-university text-9xl"></i>
                            </div>
                            
                            <div class="flex justify-between items-start relative z-10">
                                <div>
                                    <div class="flex items-center gap-2 mb-1">
                                        <i class="fas fa-wifi rotate-90 text-gray-400 text-xs"></i>
                                        <p class="text-gray-300 text-xs font-bold tracking-widest uppercase">Savings Account</p>
                                    </div>
                                    <p class="font-medium tracking-wider">HDFC Bank •••• 4582</p>
                                </div>
                                <div class="w-12 h-12 bg-white/10 rounded-full flex items-center justify-center backdrop-blur-md">
                                    <i class="fas fa-university text-xl"></i>
                                </div>
                            </div>
                            
                            <div class="relative z-10">
                                <p class="text-gray-400 text-sm mb-1">Total Available Balance</p>
                                <div class="flex items-baseline gap-2">
                                    <span class="text-4xl font-bold tracking-tight">₹${state.balance.toLocaleString('en-IN', {minimumFractionDigits: 2})}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Info Column -->
                        <div class="space-y-6">
                            <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 flex items-start gap-4">
                                <div class="w-12 h-12 rounded-full bg-green-100 flex items-center justify-center text-green-600 text-xl shrink-0">
                                    <i class="fas fa-shield-alt"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-gray-800">Bank Servers are Online</h3>
                                    <p class="text-sm text-gray-500 mt-1">UPI payments are working smoothly. You can make transactions without any interruptions.</p>
                                </div>
                            </div>

                            <div class="bg-orange-50 rounded-2xl p-6 border border-orange-100">
                                <h3 class="font-bold text-orange-800 mb-2">Monthly Spending</h3>
                                <p class="text-sm text-orange-700 mb-4">You have spent ₹${totalDebit.toLocaleString('en-IN')} this month. Keep track of your expenses in the History tab.</p>
                                <button onclick="navigate('history')" class="text-sm font-bold text-orange-600 hover:text-orange-800 flex items-center gap-1">
                                    View Statement <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </main>
                ${renderFooter()}
            `;
        }

        // --- Logic Functions ---

        function navigate(screenId) {
            state.screen = screenId;
            // Don't reset PIN when going to processing screen
            if (screenId !== 'processing') {
                state.pin = '';
            }
            closeModal();
            
            if (screenId === 'home') renderHome();
            else if (screenId === 'history') renderHistory();
            else if (screenId === 'amount') renderAmountScreen();
            else if (screenId === 'pin') renderPinScreen();
            else if (screenId === 'processing') renderProcessing();
            else if (screenId === 'success') renderSuccess();
            else if (screenId === 'balance') renderBalance();
        }

        function startPayment(type) {
            showModal(`
                <div class="p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-bold text-gray-900">Enter ${type} Details</h2>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                ${type === 'Bank Transfer' ? 'Account Number' : type === 'Self Transfer' ? 'To Account' : 'Name'}
                            </label>
                            <input type="text" id="payeeName" 
                                class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-orange-500"
                                placeholder="${type === 'Contacts' ? 'Enter name' : 'Enter account'}">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                ${type === 'Bank Transfer' ? 'IFSC Code' : type === 'Self Transfer' ? 'Bank Name' : 'UPI ID'}
                            </label>
                            <input type="text" id="payeeId" 
                                class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-orange-500"
                                placeholder="${type === 'Bank Transfer' ? 'HDFC0001234' : type === 'Self Transfer' ? 'HDFC Bank' : 'username@upi'}">
                        </div>
                        
                        <button onclick="confirmPaymentDetails()" 
                            class="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-3 rounded-xl transition">
                            Continue
                        </button>
                    </div>
                </div>
            `);
        }

        function confirmPaymentDetails() {
            const name = document.getElementById('payeeName').value;
            const id = document.getElementById('payeeId').value;
            
            if (!name || !id) {
                showToast('Please fill all details', 'error');
                return;
            }
            
            closeModal();
            initiatePay(name, id);
        }

        function initiatePay(name, id) {
            state.transaction.payeeName = name;
            state.transaction.payeeId = id;
            state.transaction.amount = '0';
            state.transaction.note = '';
            navigate('amount');
        }

        function updateAmount(val) {
            let current = state.transaction.amount;
            if (val === 'back') {
                current = current.slice(0, -1);
                if (current === '' || current === '0') current = '0';
            } else if (val === '.') {
                if (!current.includes('.')) current += '.';
            } else {
                if (current === '0') current = val;
                else current += val;
            }
            
            if (current.length > 8) return;

            state.transaction.amount = current;
            
            const display = document.getElementById('amountDisplay');
            if(display) {
                display.value = current;
                document.getElementById('payBtnAmt').innerText = '₹' + parseFloat(current || 0).toLocaleString('en-IN');
                
                const btn = document.getElementById('payBtn');
                if(parseFloat(current) > 0) {
                    btn.disabled = false;
                    btn.classList.remove('opacity-50', 'cursor-not-allowed');
                } else {
                    btn.disabled = true;
                    btn.classList.add('opacity-50', 'cursor-not-allowed');
                }
            }
        }

        function goToPin() {
            if (parseFloat(state.transaction.amount) > 0) {
                if (parseFloat(state.transaction.amount) > state.balance) {
                    showToast('Insufficient balance!', 'error');
                    return;
                }
                navigate('pin');
            }
        }

        function enterPin(key) {
            if (key === 'back') {
                state.pin = state.pin.slice(0, -1);
            } else {
                if (state.pin.length < 4) {
                    state.pin += key;
                }
            }
            updatePinUI();
        }

        function updatePinUI() {
            for (let i = 1; i <= 4; i++) {
                const dot = document.getElementById(`dot-${i}`);
                if (dot) {
                    if (i <= state.pin.length) {
                        dot.classList.add('bg-gray-800', 'border-gray-800');
                        dot.classList.remove('bg-white', 'border-gray-300');
                    } else {
                        dot.classList.remove('bg-gray-800', 'border-gray-800');
                        dot.classList.add('bg-white', 'border-gray-300');
                    }
                }
            }
        }

        function submitPin() {
            if (state.pin.length === 4) {
                navigate('processing');
            } else {
                showToast('Please enter complete PIN', 'error');
            }
        }

        function processTransaction() {
            const amt = parseFloat(state.transaction.amount);
            state.balance -= amt;
            
            const newTx = {
                id: Date.now(),
                name: state.transaction.payeeName,
                amount: amt,
                date: 'Just now',
                type: 'debit',
                status: 'success',
                upiId: state.transaction.payeeId
            };
            
            state.history.unshift(newTx);
        }

        // --- Init ---
        renderHome();

    </script>
</body>
</html>
